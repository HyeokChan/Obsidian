# AWS SAA

### Getting started with AWS
1. AWS Regions
- 데이터 센터의 집합
2. AWS 리전 선택 방법
- 법률 준수 
- 지연 시간 : 대부분의 사용자가 미국에 있다면 미국 리전을 선택하는 것이 지연시간 감소
- 사용하고자 하는 서비스가 있는 리전 선택
- 요금 : 리전별로 요금 상이
3. 가용영역 (aws avaliability zones)
- 한 리전에 여러 가용영역 존재
- 가용영역은 하나 또는 두 개의 개별적인 데이터센터로 구성
- 데이터센터 < 가용영역 < 리전
4. 엣지 로케이션
- 40여 국가의 90개 이상의 도시에 400개가 넘는 전송 지점 존재
- 엣지 로케이션을 통해 최소 지연 시간으로 컨텐츠 전달 가능


### IAM
1. IAM User & Groups
- root 계정은 계정을 생성할 때만 사용
- 그 이후는 사용자를 생성해서 사용
- 여러 사용자를 하나의 그룹으로 관리
- 그룹 내에는 사용자만 설정 가능 (그룹안에 그룹 관리 불가)
- 한 사용자가 여러 그룹에 속하는 것은 가능
2. IAM Permissions
- 생성한 사용자에게 권한 부여 가능
3. IAM Policies inheritance
- IAM 그룹 별로 정책 적용 가능
- 그룹에 속하지 않은 사용자는 인라인정책으로 적용 가능
- 한 명이 여러 그룹에 속한 경우 각 그룹의 정책이 모두 적용됨
- 커스텀하여 신규 정책 생성 가능
4. IAM Policies Structure
```JSON
{
	"Version":"2012-10-17",
	"Id":"S3-Account-Permissions",
	"Statement":[
		{
			"Sid":"1",
			"Effect":"Allow",
			"Principal": {
				"AWS":["arn:aws:iam::123456789012:root"]
			},
			"Action":[
				"s3:GetObject",
				"s3:PutObject"
			],
			"Resource": ["arn:aws:s3:::mybucket/*"]
		}
	]
}
```

- Version: 정책 언어 버전
- Id: 정책 식별자(선택 사항)
- Statement: 하나 이상의 개별 명세서(필수)
- Sid: 명령문의 식별자(선택 사항)
- Effect: 액세스를 허용하거나 거부하는지 여부(Allow, Deny)
- Principal: 이 정책이 적용된 계정/사용자/역할
- Action: 이 정책이 허용하거나 거부하는 작업 목록
- Resource: 작업이 적용되는 리소스 목록
5. IAM Password Policy - MFA (Multi Factor Authentication)
- 비밀번호와 보안장치를 함께 사용하는 방식
- 자신의 비밀번호와 MFA 생성 토큰 사용
6. MFA Devices options in AWS
- 가상 MFA 장치 (google authenticator, authy ...)
- U2F 보안키
- 하드웨어 키 팝 MFA 장치
7. IAM Roles for Services
- AWS 서비스에 권한을 부여하기 위해 사용 (AWS 서비스 별 권한 적용)
- 예를 들어 AWS EC2 인스턴스에서 AWS의 어떤 정보에 접근할 때 사용하는 권한
8. IAM Security Tools (보안도구)
- IAM 자격 증명 보고서
- IAM 액세스 관리

### AWS 접근 방법
1. AWS Management console
2. AWS 명령줄 인터페이스 (CLI)
- 리소스를 관리하는 스크립트를 통해 작업 자동화 가능
- 액세스키를 통해 접근 (액세스키, 비밀액세스키)
3. AWS 소프트웨어 개발 키트 (SDK)
- 코딩을 통해 애플리케이션 내에 심어 두어서 사용
- 다양한 프로그래밍 언어 지원(JavaScript Python, PHP, .NET, Ruby, Java, Go Node.js, C++)
4. AWS CloudShell
- CLI 대체하여 사용
- 저장소 사용 가능

### IAM 모범 사례 및 요약
1. 모범 사례
- AWS 계정 설정 외에는 루트 계정을 사용 금지
- 물리적 사용자 1명 = AWS 사용자 1명
- 사용자를 그룹에 할당하고 그룹에 권한을 할당
- 강력한 비밀번호 정책 생성
- 다단계 인증(MFA) 사용 및 시행
- AWS 서비스에 권한을 부여하기 위한 역할 생성 및 사용
- 프로그래밍 방식 액세스를 위한 액세스 키 사용(CLI/SDK)
- IAM 자격 증명 보고서 및 IAM 액세스 어드바이저을 사용하여 계정 권한을 감사
- IAM 사용자 및 액세스 키 공유 금지
2. 요약
- 사용자: 물리적 사용자에 매핑되며 AWS 콘솔에 대한 비밀번호가 존재
- 그룹: 사용자만 포함
- 정책: 사용자 또는 그룹의 권한을 설명하는 JSON 문서
- 역할: EC2 인스턴스 또는 AWS 서비스용
- 보안: MFA + 비밀번호 정책
- AWS CLI: 명령줄을 사용하여 AWS 서비스를 관리
- AWS SDK: 프로그래밍 언어를 사용하여 AWS 서비스를 관리
- 액세스 키: CLI 또는 SDK를 사용하여 AWS에 액세스
- 감사: IAM 자격 증명 보고서 및 IAM 액세스 관리자

---
### EC2 기초
1. EC2
- aws 에서 제공하는 서비스형 인프라 스트럭쳐
- 가상 서버
- 운영체제 (리눅스, 윈도우, 맥), CPU 개수, RAM, 스토리지(EBS, EFS), 네트워크, 방화벽 규칙 등 선택하여 사용 가능
-  사용자 사용자 데이터 스크립트를 사용하여 인스턴스를 부트스트래핑 가능
	(부팅 작업 자동화 및 부팅 시 특정 작업(업데이트, 소프트웨어 설치) 명령 가능)
- 다양한 성능 및 옵션으로 EC2 인스턴스 생성 가능 예시
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/3181cd03-ec08-4d45-95fc-d57856159862)
2. EC2 인스턴스 생성 과정
- 인스턴스의 운영체계 선택
- 인스턴스 타입(CPU, 메모리) 선택
- 키 페어 생성 및 선택 (인스턴스에 접근하기 위해 SSH 유틸리티를 사용하는 경우 필요)
	- 키 페어 타입, 키 페어 형식 선택
- 네트워크 설정
- 보안 그룹 생성 및 선택
- 스토리지 구성
- 사용자 데이터 스크립트 설정 (EC2 인스턴스 생성 시 실행되는 스크립트)
- 인스턴스를 중지 후 다시 시작하면 사설 IP는 유지되지만 공용 IP는 변경
3. EC2 유형
- 범용 인스턴스
	- 웹서버, 코드 저장소와 같은 다약한 작업에 적합
	- 컴퓨팅, 메모리, 네트워킹 간의 균형 좋음
- 고성능  프로세서 인스턴스(컴퓨팅 최적화)
	- 일부 데이터의 일괄 처리
	- 미디어 트랜스 코딩 작업
	- 고성능 웹서버
	- 고성능 컴퓨닝 HPC 작업
	- 머신 러닝
	- 전용 게임 서버
- 메모리 최적화 인스턴스
	- 메모리에서 대규모 데이터 셋을 처리하는 유형의 작업에 좋음
	- 인메모리 데이터베이스가 되는 고성능의 데이터베이스에 사용
	- 일라스틱캐시 등 분산 웹스케일 캐시 저장소에 사용
	- 대규모 비정형 데이터의 실시간 처리를 실행하는 애플리케이션에서 사용
- 스토리지 최적화 인스턴스
	- 로컬 스토리지에서 대규모의 데이터셋에 액세스할 때 적합
	- OLTP 시스템에 사용
	- NoSQL Database 사용
	- 메모리 데이터베이스의 캐시, 데이터 웨어하우징 애플리케이션, 분산 파일 시스템에 사용
4. 보안그룹
- EC2에 접근하는 트래픽 제어
- 방화벽 생성
- EC2 인바운드, 아웃바운드 규칙 생성 및 설정
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/c9025205-2fd6-434d-a2b7-b0fe9fc03d07)
- 보안그룹은 여러 인스턴스에 연결할 수 있음
- 보안그룹은 지역과 VPC 결합으로 통제되어 있기 때문에 지역을 전환하면 새 보안그룹을 생성해야함
- 서버 접속 시 타임아웃이 발생하면 보안그룹 확인 필요
5. EC2 IAM 역할
- EC2 SSH 접속 후 aws configure 명령어를 통해 자격증명 및 액세스 ID, 비밀 액세스 키 등 지정 하면 이 계정 상의 누구라도 EC2 인스턴스 커넥트 등을 통해 자격 증명 정보 회수 가능
- 대신 IAM 역할(ROLES)을 통해 자격 증명 설정 필요 (서비스 별 권한 적용을 하는 IAM)
6. EC2 구매 옵션
- 온디맨드 인스턴스
	- 사용한 만큼 비용 지불
	- 비용이 가장 많이 들지만 바로 지불할 금액 및 장기적인 약정 없음
	- 단기적이고 중단 없는 워크로드가 필요할 때, 애플리케이션의 거동을 예측할 수 없을 때 사용
- 예약 인스턴스
	- 온디맨드에 비해 약 72% 할인 제공
	- 특정한 인스턴스 속성(타입, 리전, 테넌시, OS) 예약
	- 1년 혹은 3년 등 예약 기간 지정 후 추가할인
	- 전부선결제, 부분선결제, 선결제없음 옵션 존재 (할인 상이)
	- 사용량이 일정한 애플리케이션에 적합
	- 전환형 예약인스턴스 : 인스턴스 속성 변경 가능하지만 할인율 감
- 절약 플랜
	- 장기간 사용 시 할인
	- 사용량이 한도를 넘어가면 온디맨드 인스턴스로 전환
- 스팟 인스턴스
	- 할인폭이 가장 큼. 온디맨드에 비해 최대 90% 할인
	- 스폿 인스턴스에 대해 지불하려는 최대가격을 정의하고 스폿가격이 그 가격을 넘게됐을 때 인스턴스 손실 발생할 수 있음(경매식). 신뢰성 낮음
	- 따라서 인스턴스 고장에 대한 회복력이 있을 때 적합
	- 배치 작업이나 데이터 분석, 이미지 처리, 분산형 워크로드, 시작 시간과 종료 시간이 유연한 워크로드에 적합
	- 아주 중요한 작업이나 데이터베이스에는 부적합
	- 스팟블록
	- 일회성 요청, 영구 인스턴스 요청 : 영구 인스턴스 요청은 인스턴스가 중단 되는 경우 스팟 요청이 다시 실행, 유효성 확인 시 스팟 인스턴스 재시작
	- 스팟 인스턴스 요청을 중지한다고 해서 스팟 인스턴스가 종료되는 것음 아님. 재 요청을 중단하는 것. 스팟 인스턴스는 EC2 메뉴에서 직접 중단 필요 
	- 스팟 플릿
		- 선택적 온디맨드 인스턴스
		- 스팟 인스턴스 세트를 정의하는 방법
		- 설정한 가격제한에 맞게 가능한 LAUNCH POOL 선택
		- 스팟 플릿에 스팟 인스턴스를 할당하는 전략
			- 최저 가격 : 스팟 플릿은 가장 낮은 가격인 풀에서 인스턴스를 시작, 워크로드가 매우 짧은 경우 적합
			- 다양성 : 스팟 인스턴스는 정의한 모든 풀에 분산, 가용성이 좋아야하는 긴 워크로드에 적합.
			- 용량 최적화 : 먼저 사용가능한 용량이 가장 큰 풀 선택, 그 중 가격이 가장 낮은 풀 선택
			
	
- 전용 호스트
	- EC2 인스턴스 용량이 있는 실제 물리적 서버
	- 규정이나 법규를 반드시 준수해야 하는 회사 관련
- 전용 인스턴스
	- 전용 하드웨어에서 실행되는 인스턴스
- 전용 호스트 VS 전용 인스턴스 : 전용 인스턴스는 자신만의 인스턴스를 자신만의 하드웨어에 갖는다는 것에 비해 전용 호스트는 물리적 서버 자체에 대한 접근성을 갖고 낮은 수준의 하드웨어에 대한 가시성만 있음
- 용량 예약
	- 특정 AZ에 온디맨드 인스턴스 예약
	- 인스턴스 사용여부에 관계 없이 예약한 인스턴스에 대해 비용 지불 필요
	- 특정한 AZ에 있어야하는 단기적이고 중단 없는 워크로드에 적합
### EC2 - 솔루션 아키텍트 어소시에이트 레벨
1. EC2 IP
- 기본값으로 EC2 기기는 내부 AWS 네트워크엔 사설 IP 사용 (AWS 네트워크에서 사설 IP는 접근 불가능)
- WWW에는 공용 IP 사용
- 인스턴스에 고정된 공용 IP를 사용하기 위해서는 탄력적 IP 필요 (탄력적IP는 사용하지 않으면 비용 발생)
- 탄력적 IP 사용보다 ROUTE 53을 통해 공용 IP 사용 및 DNS 이름 할당 하는 방법 추천
- 또는 로드밸런서를 통해 공용 IP를 사용하지 않을 수 있음
2. EC2 배치 그룹 (위치)
- EC2 인스턴스가 AWS 인프라에 배치되는 방식을 제어하고자 할 때 사용
- 배치 그룹 전략
	- 클러스터 배치 그룹
		- 단일 가용 영역 내에 지연 시간이 짧은 하드웨어 설정을 사용
		- 동일한 가용영역 및 하드웨어에 존재, 하드웨어 문제에 위험 
	- 분산 배치 그룹
		- 인스턴스가 다른 하드웨어에 분산됨
		- 가용 영역 별로 분산된 배치 그룹당 7개의 EC2 인스턴스만 가질 수 있음 => 너무 큰 애플리케이션에서는 사용 제한이 있음
	- 분할 배치 그룹
		- 분산 배치 그룹과 유사하나 하드웨어가 아닌 파티션에 의해 인스턴스 분할
		- 파티션 실패로 부터 안전함
		- 분산 배치 그룹에 비해 큰 애플리케이션에서 사용 가능함 
3. Elastic Network Interfaces (ENI)
- 탄력적 네트워크 인터페이스
- VPC의 논리적 구성 요소
- EC2 인스턴스가 네트워크에 액세스할 수 있도록 해줌
- EC2 인스턴스 생성 시 기본적으로 하나의 ENI와 연결됨
- ENI 추가 생성 및 EC2 인스턴스와 연결 가능 및 이동 가능 (같은 AZ에 있는 EC2 인스턴스와 연결 가능)
- 이를 통해 네트워크 장애 조치 가능 
4. EC2 절전모드 (Hibernate)
- RAM에 있던 인메모리 상태 보존
- 인스턴스 부팅 속도 개선
- 실행중인 EC2 존재. RAM 사용중 -> EC2 절전모드 시 RAM 내용을 EBS 볼륨으로 덤프 -> EC2 RAM은 삭제 -> EC2 인스턴스 다시 실행 시 EBS 볼륨에서 EC2 인스턴스 메모리로 RAM 내용 이동
- 사용하기 위해서 EBS 볼륨에 충분한 공간과 암호화 처리가 필요

### EC2 인스턴스 스토리지
1. EC2 인스턴스 스토리지 EBS 볼륨
- Elastic Block Store
- 인스턴스가 종료된 후에도 데이터 관리 가능
- 네트워크 드라이브 -> EC2 인스턴스에 분리되고 다른 인스턴스에 연결 가능(같은 가용영역)
- 스냅샷을 이용하여 다른 가용영역으로 볼륨 이동 가능
- CCP 레벨의 EBS볼륨은 한번에 두개 이상의 EC2 인스턴스에 연결될 수 없으며 하나의 EC2인스턴스에 여러개의 EBS 볼륨 연결은 가능
- EBS 볼륨 생성 후 EC2 인스턴스와 연결하지 않은 상태로 유지 가능
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/8f6edd88-825e-4369-9149-89ff5c2ff61b)
- EC2 인스턴스를 통해 EBS 볼륨을 생성하는 경우 EC2 인스턴스 종료 시 EBS 볼륨도 삭제하도록 설정 가능
2. EBS 스냅샷
- EBS 볼륨의 특정 시점에 대한 백업
- 다른 가용 영역이나 다른 리전에 복사 가능(재해 복구 전략에 좋음)
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/724489db-bc8e-486b-9ca9-07eb01322e85)
- 스냅샷을 스냅샷 아카이브로 이동 가능 (24~72시간 소요)
- EBS 휴지통 사용 가능 (1일~1년 보관)
- 빠른 스냅샷 복원(FSR)을 통한 EC2 인스턴스 초기화
3.  AMI (Amazon Machine Image)
- EC2 인스턴스를 통해 만든 이미지
- EC2 인스턴스에 설치하고자 하는 모든 소프트웨어를 AMI을 통해 패키징
- 기업에서 자체적으로 AMI를 구성하고 자신의 소프트웨어를 넣어서 판매하는 경우도 존재
- 다른 AZ로 EC2 인스턴스 복사할 때도 활용
4. EC2 인스턴스 스토어
- EC2 인스턴스에 연결된 물리적 서버 하드웨어 드라이브
- I/O 성능 향상을 위해 사용
- EC2 인스턴스를 중지하면 스토리지도 손실됨
- 따라서 버퍼, 캐시 등을 위해 사용
5. EBS 볼륨 유형
- gp2/gp3 : 범용 SSD 볼륨, 비용효과적
- io1/io2 : 최고성능 SSD 볼륨, 미션 크리티컬하고 지연시간이 낮고 대용량 워크로드에 사용
- st1 : 저비용의 HDD 볼륨
- 프로비저닝을 마친 IOPS
	- IOPS 성능을 유지할 필요가 있는 주요 애플리케이션
	- 16,000 IOPS 이상을 요하는 애플리케이션
	- 데이터베이스 워크로드
6. EBS 볼륨 다중 연결
- 하나의 EBS볼륨을 같은 가용영역에 있는 여러 EC2 인스턴스에 사용 가능
- 한번에 16개의 EC2 인스턴스만 같은 볼륨에 연결 가능
- 다중 연결 실행을 위해 클러스터 인식 파일 시스템 사용 필요 (XFS, EX4)
7. EBS 볼륨 암호화
- KMS 사용해서 암호화 가능
8. EFS
- 네트워크 파일 시스템
- EBS 보다 가용성과 확장성이 좋음
- 서로 다른 영역에 있는 EC2 인스턴스에 연결될 수 있음
- 콘텐츠 관리, 웹서빙, 데이터공유 등 사용사례
- 윈도우가 아닌 리눅스 기반 AMI와만 호환됨
- KMS 사용해서 암호화 가능
- 성능 모드 옵션
	- 범용 모드 : 지연시간에 민감한 사용 사례에 사용, 웹서버/CMS/Wordpress
	- I/O 모드 : 처리량 최대화, 지연시간이 더 길지만 처리량이 높고 병렬성이 높음, 빅데이터 매플리케이션/미디어 처리 시 유용 
- 처리량 옵션 
	- 버스팅 : MIB 더한 것, 파일시스템 크기와 비례한 용량
	- 프로비저닝 : 스토리지 크기에 관계 없이 처리량을 설정하고 싶은 경우 
	- 엘라스틱 : 워크로드에 따라 처리량을 자동 조절, 워크로드를 예측하기 어려울 때 유용
- 스토리지 클래스
	- 스토리지 계층 : 자주 액세스 되는 파일과 액세스 되지 않는 파일의 스토리지 계층을 이동
	- 다중 AZ로 EFS 설정 : 프로덕션 사용사례에 적합 (특정 AZ 다운 시 다른 AZ 사용)
	- 개발용 ONE ZONE EFS : 하나의 AZ에만 있어서 개발용으로 적합 
9. EBS VS EFS
- EBS 볼륨은 한 번에 하나의 인스턴스와 결합 (다중 결합 제외)
- EBS 볼륨은 하나의 AZ에 종속 (스냅샷을 통해 AZ 이동)
- EBS 볼륨 백언은 IO를 사용하므로 애플리케이션이 많은 트래픽을 처리하는 경우에는 부적합
- EFS 는 네트워크 파일 시스템으로 여러 AZ에 가용 가능
- EFS 가 EBS 보다 가격 높음

### 고가용성 및 스케일링 성 : ELB 및 ASG
1. ELB (일라스틱 로드 밸런서)
- 앞단에서 트래픽을 분산하여 여러 EC2 인스턴스에 전달
- 클래식 로드 밸런서 (CLB) -> 더 이상 지원하지 않아서 시험 X
- 애플리케이션 로드 밸런서 (ALB) : HTTP, HTTPS 애플리케이션 범용적
- 네트워크 로드 밸런서 : TCP, UDP, TLS, 고성능
- 게이트웨이 로드 밸런서 : 보안, 침입탐지, 방화벽 특화
- ELB에 보안규칙을 적용하여 EC2 에 대한 보안을 강화할 수 있음 (로드밸런서를 통해 들어오는 트래픽만 허용)
2. 애플리케이션 로드 밸런서
- 7계층, HTTP 전용 로드 밸런서
- URL 대상 경로에 기반한 라우팅 가능 (/user, /post ...)
- URL 호스트 이름, 쿼리문자열, 헤더에 기반한 라우팅 가능
- 포트 매핑 기능이 있어서 ECS 인스턴스의 동적 포트로 리다이렉션 가능 -> 마이크로서비스나 컨테이너 기반 애플리케이션에 가장 적합
- 하나의 ALB로 다수의 애플리케이션 처리 가능
3. 네트워크 로드 밸런서 : 고성능, TCP, UDP, 정적 IP
- L4 로드밸런서, TCP, UDP
- 고성능, 초당 수백만 건 처리, ALB에 비해 지연시간 짧음
- 가용영역 별로 하나의 고정 IP를 가짐 -> 여러개의 고정 IP를 가진 애플리케이션을 노출할 때 유용
- AWS 프리티어 X
- EC2 인스턴스를 대상그룹으로 두어 로드 밸런싱 할 수 있음
- ALB 앞에 NLB를 두도록 구성할 수 있음 -> NLB 덕분에 고정 IP를 얻을 수 있고 ALB로 HTTP 트래픽 분산도 가능
- 상태확인을 위해 TCP, HTTP, HTTPS 프로토콜 지원
4. 게이트웨이 로드 밸런서
- 방화벽, 침임탐지
- L3 계층
- GWLB의 2가지 기능
	- 투명 네트워크 로드 밸런서 : VPC의 모든 트래픽이 GWLB가 되는 단일 엔트리와 출구를 통과
	- 대상 그룹으로 트래픽을 분산하는 로드 밸런서
- 6081 포트의 GENEVE 프로토콜 사용 -> GWLB
5. ELB 고정 세션
- 사용자가 처음 접근했을 때 로드 밸런서를 통해 1번 인스턴스를 사용했다면 그 다음 요청도 1번 인스턴스로 보내는 것
- 쿠키를 통해 동작 (만료기간 존재)
	- 애플리케이션 기반 쿠키 (AWSALBAPP)
	- 기간 기반 쿠키 (AWSELB)
