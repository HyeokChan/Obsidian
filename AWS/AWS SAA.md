# AWS SAA

### Getting started with AWS
1. AWS Regions
- 데이터 센터의 집합
2. AWS 리전 선택 방법
- 법률 준수 
- 지연 시간 : 대부분의 사용자가 미국에 있다면 미국 리전을 선택하는 것이 지연시간 감소
- 사용하고자 하는 서비스가 있는 리전 선택
- 요금 : 리전별로 요금 상이
3. 가용영역 (aws avaliability zones)
- 한 리전에 여러 가용영역 존재
- 가용영역은 하나 또는 두 개의 개별적인 데이터센터로 구성
- 데이터센터 < 가용영역 < 리전
4. 엣지 로케이션
- 40여 국가의 90개 이상의 도시에 400개가 넘는 전송 지점 존재
- 엣지 로케이션을 통해 최소 지연 시간으로 컨텐츠 전달 가능


### IAM
1. IAM User & Groups
- root 계정은 계정을 생성할 때만 사용
- 그 이후는 사용자를 생성해서 사용
- 여러 사용자를 하나의 그룹으로 관리
- 그룹 내에는 사용자만 설정 가능 (그룹안에 그룹 관리 불가)
- 한 사용자가 여러 그룹에 속하는 것은 가능
2. IAM Permissions
- 생성한 사용자에게 권한 부여 가능
3. IAM Policies inheritance
- IAM 그룹 별로 정책 적용 가능
- 그룹에 속하지 않은 사용자는 인라인정책으로 적용 가능
- 한 명이 여러 그룹에 속한 경우 각 그룹의 정책이 모두 적용됨
- 커스텀하여 신규 정책 생성 가능
4. IAM Policies Structure
```JSON
{
	"Version":"2012-10-17",
	"Id":"S3-Account-Permissions",
	"Statement":[
		{
			"Sid":"1",
			"Effect":"Allow",
			"Principal": {
				"AWS":["arn:aws:iam::123456789012:root"]
			},
			"Action":[
				"s3:GetObject",
				"s3:PutObject"
			],
			"Resource": ["arn:aws:s3:::mybucket/*"]
		}
	]
}
```

- Version: 정책 언어 버전
- Id: 정책 식별자(선택 사항)
- Statement: 하나 이상의 개별 명세서(필수)
- Sid: 명령문의 식별자(선택 사항)
- Effect: 액세스를 허용하거나 거부하는지 여부(Allow, Deny)
- Principal: 이 정책이 적용된 계정/사용자/역할
- Action: 이 정책이 허용하거나 거부하는 작업 목록
- Resource: 작업이 적용되는 리소스 목록
5. IAM Password Policy - MFA (Multi Factor Authentication)
- 비밀번호와 보안장치를 함께 사용하는 방식
- 자신의 비밀번호와 MFA 생성 토큰 사용
6. MFA Devices options in AWS
- 가상 MFA 장치 (google authenticator, authy ...)
- U2F 보안키
- 하드웨어 키 팝 MFA 장치
7. IAM Roles for Services
- AWS 서비스에 권한을 부여하기 위해 사용 (AWS 서비스 별 권한 적용)
- 예를 들어 AWS EC2 인스턴스에서 AWS의 어떤 정보에 접근할 때 사용하는 권한
8. IAM Security Tools (보안도구)
- IAM 자격 증명 보고서
- IAM 액세스 관리

### AWS 접근 방법
1. AWS Management console
2. AWS 명령줄 인터페이스 (CLI)
- 리소스를 관리하는 스크립트를 통해 작업 자동화 가능
- 액세스키를 통해 접근 (액세스키, 비밀액세스키)
3. AWS 소프트웨어 개발 키트 (SDK)
- 코딩을 통해 애플리케이션 내에 심어 두어서 사용
- 다양한 프로그래밍 언어 지원(JavaScript Python, PHP, .NET, Ruby, Java, Go Node.js, C++)
4. AWS CloudShell
- CLI 대체하여 사용
- 저장소 사용 가능

### IAM 모범 사례 및 요약
1. 모범 사례
- AWS 계정 설정 외에는 루트 계정을 사용 금지
- 물리적 사용자 1명 = AWS 사용자 1명
- 사용자를 그룹에 할당하고 그룹에 권한을 할당
- 강력한 비밀번호 정책 생성
- 다단계 인증(MFA) 사용 및 시행
- AWS 서비스에 권한을 부여하기 위한 역할 생성 및 사용
- 프로그래밍 방식 액세스를 위한 액세스 키 사용(CLI/SDK)
- IAM 자격 증명 보고서 및 IAM 액세스 어드바이저을 사용하여 계정 권한을 감사
- IAM 사용자 및 액세스 키 공유 금지
2. 요약
- 사용자: 물리적 사용자에 매핑되며 AWS 콘솔에 대한 비밀번호가 존재
- 그룹: 사용자만 포함
- 정책: 사용자 또는 그룹의 권한을 설명하는 JSON 문서
- 역할: EC2 인스턴스 또는 AWS 서비스용
- 보안: MFA + 비밀번호 정책
- AWS CLI: 명령줄을 사용하여 AWS 서비스를 관리
- AWS SDK: 프로그래밍 언어를 사용하여 AWS 서비스를 관리
- 액세스 키: CLI 또는 SDK를 사용하여 AWS에 액세스
- 감사: IAM 자격 증명 보고서 및 IAM 액세스 관리자

---
### EC2 기초
1. EC2
- aws 에서 제공하는 서비스형 인프라 스트럭쳐
- 가상 서버
- 운영체제 (리눅스, 윈도우, 맥), CPU 개수, RAM, 스토리지(EBS, EFS), 네트워크, 방화벽 규칙 등 선택하여 사용 가능
-  사용자 사용자 데이터 스크립트를 사용하여 인스턴스를 부트스트래핑 가능
	(부팅 작업 자동화 및 부팅 시 특정 작업(업데이트, 소프트웨어 설치) 명령 가능)
- 다양한 성능 및 옵션으로 EC2 인스턴스 생성 가능 예시
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/3181cd03-ec08-4d45-95fc-d57856159862)
2. EC2 인스턴스 생성 과정
- 인스턴스의 운영체계 선택
- 인스턴스 타입(CPU, 메모리) 선택
- 키 페어 생성 및 선택 (인스턴스에 접근하기 위해 SSH 유틸리티를 사용하는 경우 필요)
	- 키 페어 타입, 키 페어 형식 선택
- 네트워크 설정
- 보안 그룹 생성 및 선택
- 스토리지 구성
- 사용자 데이터 스크립트 설정 (EC2 인스턴스 생성 시 실행되는 스크립트)
- 인스턴스를 중지 후 다시 시작하면 사설 IP는 유지되지만 공용 IP는 변경
3. EC2 유형
- 범용 인스턴스
	- 웹서버, 코드 저장소와 같은 다약한 작업에 적합
	- 컴퓨팅, 메모리, 네트워킹 간의 균형 좋음
- 고성능  프로세서 인스턴스(컴퓨팅 최적화)
	- 일부 데이터의 일괄 처리
	- 미디어 트랜스 코딩 작업
	- 고성능 웹서버
	- 고성능 컴퓨닝 HPC 작업
	- 머신 러닝
	- 전용 게임 서버
- 메모리 최적화 인스턴스
	- 메모리에서 대규모 데이터 셋을 처리하는 유형의 작업에 좋음
	- 인메모리 데이터베이스가 되는 고성능의 데이터베이스에 사용
	- 일라스틱캐시 등 분산 웹스케일 캐시 저장소에 사용
	- 대규모 비정형 데이터의 실시간 처리를 실행하는 애플리케이션에서 사용
- 스토리지 최적화 인스턴스
	- 로컬 스토리지에서 대규모의 데이터셋에 액세스할 때 적합
	- OLTP 시스템에 사용
	- NoSQL Database 사용
	- 메모리 데이터베이스의 캐시, 데이터 웨어하우징 애플리케이션, 분산 파일 시스템에 사용
4. 보안그룹
- EC2에 접근하는 트래픽 제어
- 방화벽 생성
- EC2 인바운드, 아웃바운드 규칙 생성 및 설정
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/c9025205-2fd6-434d-a2b7-b0fe9fc03d07)
- 보안그룹은 여러 인스턴스에 연결할 수 있음
- 보안그룹은 지역과 VPC 결합으로 통제되어 있기 때문에 지역을 전환하면 새 보안그룹을 생성해야함
- 서버 접속 시 타임아웃이 발생하면 보안그룹 확인 필요
5. EC2 IAM 역할
- EC2 SSH 접속 후 aws configure 명령어를 통해 자격증명 및 액세스 ID, 비밀 액세스 키 등 지정 하면 이 계정 상의 누구라도 EC2 인스턴스 커넥트 등을 통해 자격 증명 정보 회수 가능
- 대신 IAM 역할(ROLES)을 통해 자격 증명 설정 필요 (서비스 별 권한 적용을 하는 IAM)
6. EC2 구매 옵션
- 온디맨드 인스턴스
	- 사용한 만큼 비용 지불
	- 비용이 가장 많이 들지만 바로 지불할 금액 및 장기적인 약정 없음
	- 단기적이고 중단 없는 워크로드가 필요할 때, 애플리케이션의 거동을 예측할 수 없을 때 사용
- 예약 인스턴스
	- 온디맨드에 비해 약 72% 할인 제공
	- 특정한 인스턴스 속성(타입, 리전, 테넌시, OS) 예약
	- 1년 혹은 3년 등 예약 기간 지정 후 추가할인
	- 전부선결제, 부분선결제, 선결제없음 옵션 존재 (할인 상이)
	- 사용량이 일정한 애플리케이션에 적합
	- 전환형 예약인스턴스 : 인스턴스 속성 변경 가능하지만 할인율 감
- 절약 플랜
	- 장기간 사용 시 할인
	- 사용량이 한도를 넘어가면 온디맨드 인스턴스로 전환
- 스팟 인스턴스
	- 할인폭이 가장 큼. 온디맨드에 비해 최대 90% 할인
	- 스폿 인스턴스에 대해 지불하려는 최대가격을 정의하고 스폿가격이 그 가격을 넘게됐을 때 인스턴스 손실 발생할 수 있음(경매식). 신뢰성 낮음
	- 따라서 인스턴스 고장에 대한 회복력이 있을 때 적합
	- 배치 작업이나 데이터 분석, 이미지 처리, 분산형 워크로드, 시작 시간과 종료 시간이 유연한 워크로드에 적합
	- 아주 중요한 작업이나 데이터베이스에는 부적합
	- 스팟블록
	- 일회성 요청, 영구 인스턴스 요청 : 영구 인스턴스 요청은 인스턴스가 중단 되는 경우 스팟 요청이 다시 실행, 유효성 확인 시 스팟 인스턴스 재시작
	- 스팟 인스턴스 요청을 중지한다고 해서 스팟 인스턴스가 종료되는 것음 아님. 재 요청을 중단하는 것. 스팟 인스턴스는 EC2 메뉴에서 직접 중단 필요 
	- 스팟 플릿
		- 선택적 온디맨드 인스턴스
		- 스팟 인스턴스 세트를 정의하는 방법
		- 설정한 가격제한에 맞게 가능한 LAUNCH POOL 선택
		- 스팟 플릿에 스팟 인스턴스를 할당하는 전략
			- 최저 가격 : 스팟 플릿은 가장 낮은 가격인 풀에서 인스턴스를 시작, 워크로드가 매우 짧은 경우 적합
			- 다양성 : 스팟 인스턴스는 정의한 모든 풀에 분산, 가용성이 좋아야하는 긴 워크로드에 적합.
			- 용량 최적화 : 먼저 사용가능한 용량이 가장 큰 풀 선택, 그 중 가격이 가장 낮은 풀 선택
			
	
- 전용 호스트
	- EC2 인스턴스 용량이 있는 실제 물리적 서버
	- 규정이나 법규를 반드시 준수해야 하는 회사 관련
- 전용 인스턴스
	- 전용 하드웨어에서 실행되는 인스턴스
- 전용 호스트 VS 전용 인스턴스 : 전용 인스턴스는 자신만의 인스턴스를 자신만의 하드웨어에 갖는다는 것에 비해 전용 호스트는 물리적 서버 자체에 대한 접근성을 갖고 낮은 수준의 하드웨어에 대한 가시성만 있음
- 용량 예약
	- 특정 AZ에 온디맨드 인스턴스 예약
	- 인스턴스 사용여부에 관계 없이 예약한 인스턴스에 대해 비용 지불 필요
	- 특정한 AZ에 있어야하는 단기적이고 중단 없는 워크로드에 적합
### EC2 - 솔루션 아키텍트 어소시에이트 레벨
1. EC2 IP
- 기본값으로 EC2 기기는 내부 AWS 네트워크엔 사설 IP 사용 (AWS 네트워크에서 사설 IP는 접근 불가능)
- WWW에는 공용 IP 사용
- 인스턴스에 고정된 공용 IP를 사용하기 위해서는 탄력적 IP 필요 (탄력적IP는 사용하지 않으면 비용 발생)
- 탄력적 IP 사용보다 ROUTE 53을 통해 공용 IP 사용 및 DNS 이름 할당 하는 방법 추천
- 또는 로드밸런서를 통해 공용 IP를 사용하지 않을 수 있음
2. EC2 배치 그룹 (위치)
- EC2 인스턴스가 AWS 인프라에 배치되는 방식을 제어하고자 할 때 사용
- 배치 그룹 전략
	- 클러스터 배치 그룹
		- 단일 가용 영역 내에 지연 시간이 짧은 하드웨어 설정을 사용
		- 동일한 가용영역 및 하드웨어에 존재, 하드웨어 문제에 위험 
	- 분산 배치 그룹
		- 인스턴스가 다른 하드웨어에 분산됨
		- 가용 영역 별로 분산된 배치 그룹당 7개의 EC2 인스턴스만 가질 수 있음 => 너무 큰 애플리케이션에서는 사용 제한이 있음
	- 분할 배치 그룹
		- 분산 배치 그룹과 유사하나 하드웨어가 아닌 파티션에 의해 인스턴스 분할
		- 파티션 실패로 부터 안전함
		- 분산 배치 그룹에 비해 큰 애플리케이션에서 사용 가능함 
3. Elastic Network Interfaces (ENI)
- 탄력적 네트워크 인터페이스
- VPC의 논리적 구성 요소
- EC2 인스턴스가 네트워크에 액세스할 수 있도록 해줌
- EC2 인스턴스 생성 시 기본적으로 하나의 ENI와 연결됨
- ENI 추가 생성 및 EC2 인스턴스와 연결 가능 및 이동 가능 (같은 AZ에 있는 EC2 인스턴스와 연결 가능)
- 이를 통해 네트워크 장애 조치 가능 
4. EC2 절전모드 (Hibernate)
- RAM에 있던 인메모리 상태 보존
- 인스턴스 부팅 속도 개선
- 실행중인 EC2 존재. RAM 사용중 -> EC2 절전모드 시 RAM 내용을 EBS 볼륨으로 덤프 -> EC2 RAM은 삭제 -> EC2 인스턴스 다시 실행 시 EBS 볼륨에서 EC2 인스턴스 메모리로 RAM 내용 이동
- 사용하기 위해서 EBS 볼륨에 충분한 공간과 암호화 처리가 필요

### EC2 인스턴스 스토리지
1. EC2 인스턴스 스토리지 EBS 볼륨
- Elastic Block Store
- 인스턴스가 종료된 후에도 데이터 관리 가능
- 네트워크 드라이브 -> EC2 인스턴스에 분리되고 다른 인스턴스에 연결 가능(같은 가용영역)
- 스냅샷을 이용하여 다른 가용영역으로 볼륨 이동 가능
- CCP 레벨의 EBS볼륨은 한번에 두개 이상의 EC2 인스턴스에 연결될 수 없으며 하나의 EC2인스턴스에 여러개의 EBS 볼륨 연결은 가능
- EBS 볼륨 생성 후 EC2 인스턴스와 연결하지 않은 상태로 유지 가능
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/8f6edd88-825e-4369-9149-89ff5c2ff61b)
- EC2 인스턴스를 통해 EBS 볼륨을 생성하는 경우 EC2 인스턴스 종료 시 EBS 볼륨도 삭제하도록 설정 가능
2. EBS 스냅샷
- EBS 볼륨의 특정 시점에 대한 백업
- 다른 가용 영역이나 다른 리전에 복사 가능(재해 복구 전략에 좋음)
![image](https://github.com/HyeokChan/Obsidian/assets/48059565/724489db-bc8e-486b-9ca9-07eb01322e85)
- 스냅샷을 스냅샷 아카이브로 이동 가능 (24~72시간 소요)
- EBS 휴지통 사용 가능 (1일~1년 보관)
- 빠른 스냅샷 복원(FSR)을 통한 EC2 인스턴스 초기화
3.  AMI (Amazon Machine Image)
- EC2 인스턴스를 통해 만든 이미지
- EC2 인스턴스에 설치하고자 하는 모든 소프트웨어를 AMI을 통해 패키징
- 기업에서 자체적으로 AMI를 구성하고 자신의 소프트웨어를 넣어서 판매하는 경우도 존재
- 다른 AZ로 EC2 인스턴스 복사할 때도 활용
4. EC2 인스턴스 스토어
- EC2 인스턴스에 연결된 물리적 서버 하드웨어 드라이브
- I/O 성능 향상을 위해 사용
- EC2 인스턴스를 중지하면 스토리지도 손실됨
- 따라서 버퍼, 캐시 등을 위해 사용
5. EBS 볼륨 유형
- gp2/gp3 : 범용 SSD 볼륨, 비용효과적
- io1/io2 : 최고성능 SSD 볼륨, 미션 크리티컬하고 지연시간이 낮고 대용량 워크로드에 사용
- st1 : 저비용의 HDD 볼륨
- 프로비저닝을 마친 IOPS
	- IOPS 성능을 유지할 필요가 있는 주요 애플리케이션
	- 16,000 IOPS 이상을 요하는 애플리케이션
	- 데이터베이스 워크로드
6. EBS 볼륨 다중 연결
- 하나의 EBS볼륨을 같은 가용영역에 있는 여러 EC2 인스턴스에 사용 가능
- 한번에 16개의 EC2 인스턴스만 같은 볼륨에 연결 가능
- 다중 연결 실행을 위해 클러스터 인식 파일 시스템 사용 필요 (XFS, EX4)
7. EBS 볼륨 암호화
- KMS 사용해서 암호화 가능
8. EFS
- 네트워크 파일 시스템
- EBS 보다 가용성과 확장성이 좋음
- 서로 다른 영역에 있는 EC2 인스턴스에 연결될 수 있음
- 콘텐츠 관리, 웹서빙, 데이터공유 등 사용사례
- 윈도우가 아닌 리눅스 기반 AMI와만 호환됨
- KMS 사용해서 암호화 가능
- 성능 모드 옵션
	- 범용 모드 : 지연시간에 민감한 사용 사례에 사용, 웹서버/CMS/Wordpress
	- I/O 모드 : 처리량 최대화, 지연시간이 더 길지만 처리량이 높고 병렬성이 높음, 빅데이터 매플리케이션/미디어 처리 시 유용 
- 처리량 옵션 
	- 버스팅 : MIB 더한 것, 파일시스템 크기와 비례한 용량
	- 프로비저닝 : 스토리지 크기에 관계 없이 처리량을 설정하고 싶은 경우 
	- 엘라스틱 : 워크로드에 따라 처리량을 자동 조절, 워크로드를 예측하기 어려울 때 유용
- 스토리지 클래스
	- 스토리지 계층 : 자주 액세스 되는 파일과 액세스 되지 않는 파일의 스토리지 계층을 이동
	- 다중 AZ로 EFS 설정 : 프로덕션 사용사례에 적합 (특정 AZ 다운 시 다른 AZ 사용)
	- 개발용 ONE ZONE EFS : 하나의 AZ에만 있어서 개발용으로 적합 
9. EBS VS EFS
- EBS 볼륨은 한 번에 하나의 인스턴스와 결합 (다중 결합 제외)
- EBS 볼륨은 하나의 AZ에 종속 (스냅샷을 통해 AZ 이동)
- EBS 볼륨 백언은 IO를 사용하므로 애플리케이션이 많은 트래픽을 처리하는 경우에는 부적합
- EFS 는 네트워크 파일 시스템으로 여러 AZ에 가용 가능
- EFS 가 EBS 보다 가격 높음

### 고가용성 및 스케일링 성 : ELB 및 ASG
1. ELB (일라스틱 로드 밸런서)
- 앞단에서 트래픽을 분산하여 여러 EC2 인스턴스에 전달
- 클래식 로드 밸런서 (CLB) -> 더 이상 지원하지 않아서 시험 X
- 애플리케이션 로드 밸런서 (ALB) : HTTP, HTTPS 애플리케이션 범용적
- 네트워크 로드 밸런서 : TCP, UDP, TLS, 고성능
- 게이트웨이 로드 밸런서 : 보안, 침입탐지, 방화벽 특화
- ELB에 보안규칙을 적용하여 EC2 에 대한 보안을 강화할 수 있음 (로드밸런서를 통해 들어오는 트래픽만 허용)
2. 애플리케이션 로드 밸런서
- 7계층, HTTP 전용 로드 밸런서
- URL 대상 경로에 기반한 라우팅 가능 (/user, /post ...)
- URL 호스트 이름, 쿼리문자열, 헤더에 기반한 라우팅 가능
- 포트 매핑 기능이 있어서 ECS 인스턴스의 동적 포트로 리다이렉션 가능 -> 마이크로서비스나 컨테이너 기반 애플리케이션에 가장 적합
- 하나의 ALB로 다수의 애플리케이션 처리 가능
3. 네트워크 로드 밸런서 : 고성능, TCP, UDP, 정적 IP
- L4 로드밸런서, TCP, UDP
- 고성능, 초당 수백만 건 처리, ALB에 비해 지연시간 짧음
- 가용영역 별로 하나의 고정 IP를 가짐 -> 여러개의 고정 IP를 가진 애플리케이션을 노출할 때 유용
- AWS 프리티어 X
- EC2 인스턴스를 대상그룹으로 두어 로드 밸런싱 할 수 있음
- ALB 앞에 NLB를 두도록 구성할 수 있음 -> NLB 덕분에 고정 IP를 얻을 수 있고 ALB로 HTTP 트래픽 분산도 가능
- 상태확인을 위해 TCP, HTTP, HTTPS 프로토콜 지원
4. 게이트웨이 로드 밸런서
- 방화벽, 침임탐지
- L3 계층
- GWLB의 2가지 기능
	- 투명 네트워크 로드 밸런서 : VPC의 모든 트래픽이 GWLB가 되는 단일 엔트리와 출구를 통과
	- 대상 그룹으로 트래픽을 분산하는 로드 밸런서
- 6081 포트의 GENEVE 프로토콜 사용 -> GWLB
5. ELB 고정 세션
- 사용자가 처음 접근했을 때 로드 밸런서를 통해 1번 인스턴스를 사용했다면 그 다음 요청도 1번 인스턴스로 보내는 것
- 쿠키를 통해 동작 (만료기간 존재)
	- 애플리케이션 기반 쿠키 (AWSALBAPP)
	- 기간 기반 쿠키 (AWSELB)
6. 교차 영역 밸런싱
- 트래픽을 여러 가용영역의 인스턴스로 같은 비율로 로드 밸런싱
- 애플리케이션 로드 밸런서는 기본적으로 교차영역밸런싱으로 동작함 (대상그룹의 속성에서 비활성화 가능)
- 네트워크 로드밸런서, 게이트웨이 로드밸런서는 기본적으로 비활성화 되어있음 (비용 지불 필요)
7. ELB SSL/TLS
8. SNI
- 여러개의 SSL인증서를 하나의 웹서버에 로드해서 하나의 웹서버가 여러개의 웹사이트를 지원할 수 있게 해줌
- ALB, NLB, CloudFront 에서 지원
9. Connection Draining (연결 드레이닝, 등록 취소 지연)
- 인스턴스가 등록 취소, 혹은 비정상인 상태에 있을 때 인스턴스에 어느 정도의 시간을 주어 활성 요청을 완료할 수 있게 하는 기능
- 등록취소 중인 인스턴스에 새로운 요청을 보내지 않음
10. Auto Scaling Group (ASG)
- 증가/감소한 로드에 맞춰 EC2 인스턴스를 자동으로 추가/제거
- CloudWatch(모니터링도구)와 통합되어 알림 발생 시 자동으로 스케일 인/아웃 가능
- ASG를 생성하면서 EC2 생성, ELB 설정 가능
11. ASG 스케일링 정책
- 단순히 cpu 사용률이나 특정 시간에 따라 미리 지정하는 스케일링 정책
- 예측 스케일링 정책
- Scaling Cooldowns : 스케일인/아웃 된 후 5분간은 해당 인스턴스의 안정화 시간이 필요함

### AWS RDS, Aurora, ElastiCache
1.  RDS
- 완전 자동화 서비스
- 지속적으로 백업 생성 및 복원 가능
- 읽기 전용 복제본 활용 가능
- 재해복구를 위해 다중 AZ 구성 가능
- 수직/수평 확장 가능
- RDS 인스턴스에 SSH 액세스는 불가능
- 오토스케일링 기능 활성화하면 스토리지 용량 증가 가능
2. RDS 읽기 전용 복제본
- 읽기 전용 복제본을 만들어서 성능 향상 가능 (읽기 성능 집중)
- 여러 가용영역이나 리전을 걸쳐서 생성 가능
- 비동기식 복제
- 완전 관리형 서비스이기 때문에 AZ간 이동해도 비용이 발생하지 않음 
- 하지만 리전 간 이동하는 경우 네트워크에 대한 복제 비용이 발생
3. RDS 다중 AZ
- 재해 복구에 사용
- 동기식 복제
- 가용성을 높힐 수 있음, 장애 대비
- 메인 디비에 문제가 발생하는 경우 자동으로 다중AZ로 복제된 디비가 메인 디비로 사용됨
- 재해 복구를 대바해서 읽기 전용 복제본을 다중 AZ로 설정할 수도 있음
- 싱글 AZ를 다중 AZ로 변경할 때 다운타임 없음
4. RDS 커스텀
- 오라클, ms sql에서만 사용 가능
- db os 접근 및 수정 가능, 관리 권한
5. Aurora
- 10GB 기본으로 시작하지만 128TB 까지 자동으로 증가
- RDS 보다 20퍼센트 정도 비싸지만 스케일링에 효과적
- 3개의 AZ에 총 6개의 사본을 만들어서 가용성이 높음
- 자가 복구 기능이 있음. 백엔드에서 P2P 복제를 통해
- 마스터에 문제가 생기면 다른 읽기 복제본이 마스터를 대체함
- 라이터 엔드포인트 : DNS 이름으로 항상 마스터를 가리킴
- 마스터 외에 다수의 읽기 복제본이 존재하며 15개까지 생성 가능
- 리더 엔드포인트 : 모든 읽기 전용 복제본과 자동으로 연결되어 로드밸런싱을 가능하게함
- 삭제 시 리더 엔드포인트, 라이터 엔드포인트 삭제 후 오로라 삭제
6. 오로라 고급 개념
- 오토스케일링 : 클라이언트 트래픽이 많은 경우 읽기 전용 복제본을 더 생성하고 리더 엔트포인트에 연결함
- 사용자 지정 엔드포인트 : 읽기 전용 복제본 간에 사이즈를 다른 경우 사이즈가 큰 복제본에 특정 엔드포인트로 설정하여 처리할 수 있음
- 서버리스 : 용량 계획을 세울 필요가 없어서 워크로드가 많지 않거나 간헐적이거나 예측할 수 없을 때 효율적
- 멀티마스터 : 라이터노드에 지속적인 쓰기 작업이 필요할 때 사용
- 글로벌 오로라 : 리전간에 읽기 전용 복제본이 있는 경우
- 글로벌 데이터베이스의 데이터를 리전 간 복제하는 데 평균 1초 미만이 소요되는 것 -> 오로라
- 오로라는 머신러닝 부분과도 통합되어 있음(사기탐지, 감성분, 광고 타겟팅, 제품 추천)
7. RDS 백업
- 자동 백업을 통해 5분전 데이터 백업 가능, 비활성화 가능
- 수동 데이터베이스 스냅샷을 통해 수동 백업, 자동 백업과 달리 원하는 기간 만큼 백업 가능
- 스냅샷 기능을 통해 데이터베이스 유지 비용 감소 가능
8. 오로라 백업
- 자동 백업 : 1일에서 35일까지 가능, 비활성화 불가
- 시점 복구 기능을 통해 특정 시점으로 복구 가능
- 스냅샷을 통한 백업
9. 오로라 데이터베이스 복제
- 백업 및 복원 작업 대신 복제도 가능, 더 빠름
10. RDS, 오로라 보안
- KMS 를 통해  암호화 실행됨
- 마스터가 암호화 되어야 읽기 전용 복제본도 암호화 가능
- 로그인/패스워드 말고 IAM을 통해서도 접근 가능
11. RDS 프록시
- 프록시를 사용하면 애플리케이션이 데이터베이스 내에서 데이터베이스 연결 풀을 형성하고 공유할 수 있음
- RDS 데이터베이스 인스턴스에 연결이 많은 경우 CPU와 RAM 등 데이터베이스 리소스의 부담을 줄여서 효율성을 향상시킬 수 있음
- RDS 프록시가 장애 조치가 발생한 RDS 데이터베이스 인스턴스를 처리하므로 장애 조치 시간이 개선됨
- 데이터베이스에 IAM 인증을 강제함
- RDS는 퍼블릭 액세스가 불가능하고 VPC를 통해서만 액세스 가능
- RDS 프록시를 사용해서 Lambda 함수의 연결 풀 생성 가능
12. ElastiCache
- 캐싱 기술인 Redis 또는 Memcached를 관리할 수 있도록 도와줌
- 애플리케이션을 상태 비저장형으로 할 수 있게 도와줌
- 사용 시 캐시를 쿼리하도록 애플리케이션 변경 필요
- Redis
	- 자동 장애 조치 기능이 있는 다중 AZ 존재
	- 읽기 복제본 있음
	- RDS와 유사
	- AOF 지속성을 이용한 데이터 내구성 있음, 백원 및 복원 기능
	- 데이터 내구성에 대한 것. 기능 면에서는 캐시로서, 세트 및 정렬된 세트 지원
- Memcached
	- 데이터 분할을 위해 멀티 노드를 사용함 -> 샤딩
	- 고가용성이 없고 복제가 일어나지 않음
	- 영구 캐시가 아니고 백업 및 복원 없음
	- 분산되어 있는 순수한 캐시
13. ElastiCache 보안
- Redis의 경우 IAM 사용, 나며지는 사용자이름과 비밀번호
- Redis AUTH
- SSL 전송 중 암호화 지원
- Memcached는 SASL 기반 승인 제공
14. ElastiCache 데이터 로드 패턴
- 지연로딩 -> 캐시 히트 체크 후 처리
- Write Through : 데이터베이스에 기록될 때마다 캐시에 데이터를 추가하거나 업데이트
- Redis 정렬된 세트 : 요소가 추가될 때마다 실시간으로 순위 매긴 후 올바른 순서로 추가

### Route 53
1. DNS
- Domain Name System
- url -> ip 변환
- 도메인 레지스트리 : 도메인 이름을 등록하는 곳(route 53, GoDaaddy .. )
2. Route 53
- 고가용성, 확장성을 갖춘 완전히 관리되며 권한이 있는 DNS
- 리소스 관련 상태 확인 가능
- SLA 가용성을 제공하는 유일한 AWS 서비스
- TTL : DNS 리존버에서 레코드가 캐싱 되는 시간 (타임 투 리브)
- 레코드 종류 
	- A : 호스트이름과 IPv4 IP 매핑
	- AAAA : 호스트이름과 IPv6 IP 매핑
	- CNAME : 호스트이름과 다른 호스트이름 매핑 
	- NS : 호스팅 존의 이름 서버, 트래픽이 도메인으로 라우팅되는 방식을 제어
3. 호스팅 존
- 레코드의 컨테이너
- 도메인과 서브도메인으로 가는 트래픽의 라우팅 방식 정의
- 퍼블릭 호스팅 존 : 공개되는 도메인 이름, 요청 쿼리에 응답 가능 
- 프라이빗 호스팅 존 : 공개되지 않는 도메인 이름 지원, VPC에서만 동작
4. TTL
- Time To Live
- TTL은 클라이언트에게 DNS 요청 결과를 캐시하도록 요청
- 클라이언트가 같은 url을 접속했을 때 DNS 시스템에게 쿼리를 보내지 않고 서버 접속 가능
5. CNAME vs Alias
- CNAME은 호스트 이름이 다른 호스트 이름으로 향하도록 할 수 있음. 하지만 루트 도메인 이름이 아닌 경우에만 가능
- Alias 별칭 레코드는 Route 53에 한정되지만 호스트 이름이 특정 AWS 리소스로 향하도록 할 수 있음
- 별칭 레코드는 루트 및 비루트 도메인 모두에 작동 가능
- 별칭 레코드 대상
	- ELB
	- CloudFront
	- API Gateway
	- 일라스틱 빈스톡
	- S3 웹사이트 (S3 버킷 아님)
	- VPC 인터페이스 엔드포인트
	- 글로벌 엑셀러레이터
	- 동일 호스트존의 Route 53
- EC2 DNS 이름은 별칭 레코드의 대상이 될 수 없음
6. 라우팅 정책
- DNS 관점의 라우팅 (로드밸런서 라우팅 아님)
- 단순 라우팅 정책
	- 일반적으로 트래픽을 단일 리소스로 보내는 방식
	- 단순 라우팅 정책에 별칭 레코드를 함께 사용하면 하나의 AWS 리소스만을 대상으로 지정할 수 있음
	- 상태 확인은 할 수 없음
- 가중치 기반 라우팅 정책
	- 가중치를 활용해서 요청의 일부 비율을 특정 리소스로 보냄
	- 해당 레코드로 트래픽을 얼마나 보낼 지 결정 가능
	- DNS 레코드들은 동일한 이름과 유형을 가져야 함
	- 서로 다른 지역들에 걸쳐 로드 밸런싱 해야하거나 적은 양의 트래픽을 보내 새 애플리케이션을 테스트 하는 경우 사용
- 지연 시간 기반 라우팅 정책
	- 지연시간이 가장 짧은, 가장 가까운 리소스로 리다이렉팅 하는 정책
	- 지연 시간에 민감한 웹사이트나 애플리케이션에 사용
- 라우팅 정책 지리적 위치
	- 지연 시간 기반의 정책과는 다르게 사용자의 실제 위치를 기반으로 함
	- 사용자의 위치와 설정한 정책 위치가 같지 않으면 기본 레코드를 사용함
- 지리적 근접 라우팅
	- 사용자와 리소스의 지리적 위치를 기반으로 트래픽을 리소스로 라우팅
	- 편향값을 사용해 특정 위치를 기반으로 더 많은 트래픽을 이동
	- 지리적 위치에 편향값으로 가중치를 설정하는 느낌
- IP 기반 라우팅 정책
	- 클라이언트 IP 주소를 기반으로 라우팅
	- CIDR에 따라 트래픽을 어느 애플리케이션으로 보낼 지 정함
- 다중 값 정책
	- 트래픽을 다중 리소스로 라우팅할 때 사용
	- 클라이언트 측면의 로드 밸런싱

7. Route 53 상태 확인
- 공용 리소스, 개인 리소스의 상태를 확인 하는 방법
- 사용 불가능한 상태의 인스턴스로 트래픽을 보내지 않기 위해 상태 체크
- 공용 엔드 포인트 모니터링
- 계산된 상태 확인 : 여러개의 상태 확인 결과를 하나로 합침
- CloudWatch 경보의 상태를 모니터링 : 개인 리소스 상태 확인 방법, 다른 방법은 VPC가 외부에 있어서 확인 못함
8. 라우팅 정책 장애 조치
- 상태 확인이 비정상이면 Route 53은 자동으로 2번째의 EC2 인스턴스로 연결해서 장애 조치

### 클래식 솔루션 아키텍처
1. WhatIsTheTime.com
- 공용 EC2 인스턴스 t2.micro
- 고정 IP 주소를 설정하기 위해 탄력적 IP주소 연결
- 앱에 대한 트래픽이 많아 지면서 m5.large 인스턴스로 수직적 확장
- 하지만 수직적 확장을 진행하는 동안에 다운타임 발생
- m5.large 인스턴스를 추가하여 수평적확장 진행 (추가된 인스턴스들도 모두 탄력적 IP와 연결되어 있음) -> 세개의 EC2 인스턴스와 세개의 탄력적 IP
- 사용자들이 이 앱에 접근하기 위해서는 각각의 탄력적 IP를 알고 있어야 하는 불편함이 있음
- -> 탄력적 IP를 제거하고 Route 53 활성화
- 인스턴스들을 상황에 따라 즉각적으로 추가하거나 제거하고 싶은데 제거하는 경우 Route 53 레코드에 설정한 TTL 만큼 사용자가 제거된 인스턴스로 접속할 수 있음
- -> 로드 밸런서 추가 필요
- 로드 밸런서에서도 상태 확인 기능이 있어서 제거된 인스턴스로는 트래픽을 보내지 않게 할 수 있음
- 로드 밸런서가 IP 주소를 지속적으로 바꾸기 때문에 Route 53 A 레코드를 사용할 수 없고 별칭 레코드를 사용해야함
- 오토 스케일링 그룹(ASG)를 사용해서 수동으로 인스턴스를 추가/제거 하지 않아도 됨
 - 지진이 발생해서 가용영억 1번이 다운되면 애플리케이션도 다운됨
 - -> 다중 AZ를 사용해서 가용성 높임
 - 애플리케이션의 비용을 줄이기 위해 1년 내내 사용할 인스턴스를 예약 인스턴스로 변경
2. MyClothes.com
- Route 53, 다중 AZ, ELB, ASG
- 장바구니를 생성하고 다음 요청 때 장바구니를 생성한 인스턴스가 아닌 다른 인스턴스로 가는 경우 장바구니가 사라지는 현상 발생할 수 있음
- -> ELB의 세션 밀접도(ELB Stickness)를 도입해 다음 요청 때 동일한 인스턴스로 가게 함
- 하지만 만약 EC2 인스턴스가 어떤 이유로 종료되면 장바구니 정보도 사라지게됨
- 사용자 쿠키를 사용해서 EC2 인스턴스가 장바구니 내용을 저장하는 대신 사용자쪽에서 장바구니 내용을 저장하도록 함
- -> 그러나 HTTP 요청이 점점 더 무거워지는 문젝 ㅏ있음
- 또한 쿠키가 공격자에 의해 변경될 수 있음
- -> EC2 인스턴스가 반드시 사용자 쿠키의 내용을 검증해야함
- 서버 세션 개념 도입해서 세션 ID만 보냄
- 백그라운드의 ElastiCache 클러스터가 장바구니 내용을 찾아서 세션 데이터를 불러올 수 있음
- 사용자 데이터를 데이터베이스에 저장하려고 함
- -> RDS 인스턴스와 통신하여 장기적인 저장 수행
- 사용자가 늘어서 읽기 트래픽이 증가함
- -> RDS 읽기 전용 복제본 생성하여 처리
- -> ElastiCache를 활용하여 읽기 성능 향상
- 재난에 대비하여 RDS도 다중 AZ 기능 적용
- 또다른 방법으로 인계 받을 수 있는 대기 복제본 사용
- -> Redis
3. MyWordPress.com
- 어떤 드라이브에 그림을 저장하고 기본적으로 모든 인스턴스들이 그 데이터에 접근해야함
- 사용자 데이터와 블로그 내용 등 모든게 MySQL 데이터베이스에 저장되어야 하고 글로벌하게 확장할 수 있어야 함
- -> RDS가 있는 계층 생성
- 더 크게 확장하고 싶은 경우 이 계층을 오로라 MySQL로 교체
- 다중 AZ, 읽기 전용 복제번, 글로벌 데이터베이스까지 적용 가능
- 이미지 저장
- -> EBS 볼륨에 저장하고 불러옴
- EBS 볼륨을 확장하는 경우 하나의 EBS볼륨에만 특정 이미지가 저장되고 나머지 볼륨에는 없음
- -> EFS를 사용
- 탄력적 네트워크 인터페이스를 위해 각각의 AZ에 ENI 생성
- -> 스토리지가 모든 인스턴스에게 공유됨
4. 애플리케이션을 더 빠르게 인스턴스화 하는 방법
- EC2 인스턴스에서 Golden AMI 사용
- EC2 생성 시 사용자데이터 사용
- -> 위 2개 혼합해서 사용
- RDS 데이터베이스는 스냅샷 복구를 통해 빠른 생성
- EBS 도 스냅샷을 통해 빠른 생성 및 복구
5. Elastic Beanstalk
- 여러 애플리케이션에 대해 AWS 서비스를 적용할 때 비슷한 설정을 하는 경우가 많은데 각각 매번 생성하고 설정하기 번거로움
- -> Elastic Beanstalk 사용
- 하나의 인터페이스에서 EC2, ASG, ELB, RDS 등 모든 컴포넌트를 재사용하는 개념
- 